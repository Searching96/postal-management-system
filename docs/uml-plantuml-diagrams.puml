@startuml use-case-diagram
' ============================================
' SÆ  Äá»’ USE CASE Tá»”NG THá»‚
' Há»‡ Thá»‘ng Quáº£n LÃ½ BÆ°u ChÃ­nh
' ============================================

left to right direction
skinparam packageStyle rectangle
skinparam actorStyle awesome

title SÆ¡ Äá»“ Use Case - Há»‡ Thá»‘ng Quáº£n LÃ½ BÆ°u ChÃ­nh

actor "System Admin" as SA #LightBlue
actor "Hub Admin" as HA #LightGreen
actor "Province Admin" as PA #LightYellow
actor "Ward Manager" as WM #Orange
actor "Warehouse Staff" as WS #Pink
actor "Counter Staff" as CS #Cyan
actor "Shipper" as SH #Lime
actor "Customer" as CU #Gold
actor "Guest" as GU #LightGray

rectangle "Há»‡ Thá»‘ng Quáº£n LÃ½ BÆ°u ChÃ­nh" {
    usecase "UC01: Táº¡o ÄÆ¡n HÃ ng" as UC1
    usecase "UC02: Theo DÃµi ÄÆ¡n HÃ ng" as UC2
    usecase "UC03: Quáº£n LÃ½ LÃ´ HÃ ng" as UC3
    usecase "UC04: Giao HÃ ng" as UC4
    usecase "UC05: Quáº£n LÃ½ BÆ°u Cá»¥c\n& NhÃ¢n ViÃªn" as UC5
}

CS --> UC1
CU --> UC1
CU --> UC2
GU --> UC2
WS --> UC3
SH --> UC4
WM --> UC4
WM --> UC5
SA --> UC5
HA --> UC5
PA --> UC5

@enduml


@startuml actor-hierarchy
' ============================================
' SÆ  Äá»’ PHÃ‚N Cáº¤P ACTOR
' ============================================

skinparam packageStyle rectangle

title PhÃ¢n Cáº¥p Tá»• Chá»©c - Actor Hierarchy

package "Trá»¥ Sá»Ÿ ChÃ­nh" {
    actor "SYSTEM_ADMIN" as SA #LightBlue
}

package "Hub Miá»n Báº¯c" {
    actor "HUB_ADMIN" as HA1 #LightGreen
}

package "Hub Miá»n Trung" {
    actor "HUB_ADMIN" as HA2 #LightGreen
}

package "Hub Miá»n Nam" {
    actor "HUB_ADMIN" as HA3 #LightGreen
}

package "Tá»‰nh" {
    actor "PROVINCE_ADMIN\n(Kho)" as PA1 #LightYellow
    actor "PROVINCE_ADMIN\n(BÆ°u cá»¥c)" as PA2 #LightYellow
}

package "PhÆ°á»ng/XÃ£" {
    actor "WARD_MANAGER" as WM1 #Orange
    actor "WARD_MANAGER" as WM2 #Orange
    actor "STAFF" as ST #Pink
    actor "SHIPPER" as SH #Lime
}

SA --> HA1
SA --> HA2
SA --> HA3

HA1 --> PA1
HA1 --> PA2

PA1 --> WM1
PA1 --> WM2

WM1 --> ST
WM1 --> SH

@enduml


@startuml uc01-activity-create-order
' ============================================
' UC01: Táº O ÄÆ N HÃ€NG - Activity Diagram
' ============================================

skinparam activity {
    BackgroundColor #FEFECE
    BorderColor #A80036
    StartColor green
    EndColor red
    DiamondBackgroundColor #FFFACD
}

title Activity Diagram - UC01: Táº¡o ÄÆ¡n HÃ ng

start

:Chá»n táº¡o Ä‘Æ¡n hÃ ng má»›i;

:Nháº­p SÄT ngÆ°á»i gá»­i;

if (ÄÃ£ cÃ³ trong DB?) then (CÃ³)
    :Tá»± Ä‘á»™ng Ä‘iá»n thÃ´ng tin;
else (KhÃ´ng)
    :Nháº­p thÃ´ng tin má»›i;
endif

:Nháº­p thÃ´ng tin ngÆ°á»i nháº­n vÃ  Ä‘á»‹a chá»‰;

:Nháº­p thÃ´ng tin bÆ°u kiá»‡n
(Loáº¡i, cÃ¢n náº·ng, kÃ­ch thÆ°á»›c);

:TÃ­nh toÃ¡n giÃ¡ theo cÃ¡c dá»‹ch vá»¥
EXPRESS / STANDARD / ECONOMY;

:Chá»n dá»‹ch vá»¥ váº­n chuyá»ƒn;

:ThÃªm tÃ¹y chá»n
(Báº£o hiá»ƒm, COD...);

:Táº¡o mÃ£ tracking
VN + 9 sá»‘ + VN;

:LÆ°u Ä‘Æ¡n hÃ ng vÃ o DB;

if (ÄÆ¡n online?) then (CÃ³)
    :Status: PENDING_PICKUP;
else (KhÃ´ng)
    :Status: AT_ORIGIN_OFFICE;
endif

:In phiáº¿u gá»­i & mÃ£ váº¡ch;

stop

@enduml


@startuml uc01-sequence-create-order
' ============================================
' UC01: Táº O ÄÆ N HÃ€NG - Sequence Diagram
' ============================================

skinparam sequenceArrowThickness 2
skinparam participantPadding 20

title Sequence Diagram - UC01: Táº¡o ÄÆ¡n HÃ ng

actor "NhÃ¢n viÃªn Quáº§y" as NV #Gold
participant "OrderUI" as UI #LightBlue
participant "OrderController" as OC #LightGreen
participant "OrderService" as OS #Pink
participant "PricingService" as PS #Orange
participant "TrackingGenerator" as TG #Cyan
database "Database" as DB #LightGray

autonumber

NV -> UI: Má»Ÿ form táº¡o Ä‘Æ¡n
NV -> UI: Nháº­p SÄT ngÆ°á»i gá»­i

UI -> OC: GET /customers?phone={phone}
activate OC
OC -> OS: findByPhone()
activate OS
OS -> DB: SELECT * FROM customers
activate DB
DB --> OS: Customer data
deactivate DB
OS --> OC: CustomerDTO
deactivate OS
OC --> UI: ThÃ´ng tin khÃ¡ch hÃ ng
deactivate OC
UI --> NV: Hiá»ƒn thá»‹ thÃ´ng tin (náº¿u cÃ³)

NV -> UI: Nháº­p thÃ´ng tin Ä‘Æ¡n hÃ ng

UI -> OC: POST /orders/preview
activate OC
OC -> OS: calculatePrice()
activate OS
OS -> PS: calculate(weight, distance, service)
activate PS
PS --> OS: PriceOptions[]
deactivate PS
OS --> OC: PreviewDTO
deactivate OS
OC --> UI: GiÃ¡ cÃ¡c dá»‹ch vá»¥
deactivate OC
UI --> NV: Hiá»ƒn thá»‹ báº£ng giÃ¡

NV -> UI: Chá»n dá»‹ch vá»¥ & xÃ¡c nháº­n

UI -> OC: POST /orders
activate OC
OC -> OS: createOrder()
activate OS
OS -> TG: generate()
activate TG
TG --> OS: "VN123456789VN"
deactivate TG
OS -> DB: INSERT INTO orders
activate DB
DB --> OS: Order created
deactivate DB
OS --> OC: OrderDTO
deactivate OS
OC --> UI: Order + Tracking number
deactivate OC
UI --> NV: Hiá»ƒn thá»‹ Ä‘Æ¡n + phiáº¿u in

@enduml


@startuml uc02-activity-tracking
' ============================================
' UC02: THEO DÃ•I ÄÆ N HÃ€NG - Activity Diagram
' ============================================

skinparam activity {
    BackgroundColor #FEFECE
    BorderColor #A80036
    StartColor green
    EndColor red
}

title Activity Diagram - UC02: Theo DÃµi ÄÆ¡n HÃ ng

start

:Nháº­p mÃ£ tracking;

:Gá»­i request tra cá»©u;

if (MÃ£ tracking há»£p lá»‡?) then (CÃ³)
    :Truy váº¥n thÃ´ng tin Ä‘Æ¡n hÃ ng;
    
    :Hiá»ƒn thá»‹ thÃ´ng tin cÆ¡ báº£n
    (NgÆ°á»i gá»­i/nháº­n, Tráº¡ng thÃ¡i);
    
    :Hiá»ƒn thá»‹ timeline
    tráº¡ng thÃ¡i vá»›i thá»i gian;
    
    if (Tráº¡ng thÃ¡i = OUT_FOR_DELIVERY?) then (CÃ³)
        :Hiá»ƒn thá»‹ nÃºt "Xem vá»‹ trÃ­ shipper";
        
        if (Nháº¥n xem?) then (CÃ³)
            :Káº¿t ná»‘i WebSocket;
            
            :Hiá»ƒn thá»‹ báº£n Ä‘á»“ vá»›i vá»‹ trÃ­ GPS;
            
            repeat
                :Cáº­p nháº­t vá»‹ trÃ­ má»—i 5 giÃ¢y;
            repeat while (ÄÃ£ giao?) is (ChÆ°a)
            ->Rá»“i;
        endif
    endif
else (KhÃ´ng)
    :Hiá»ƒn thá»‹ lá»—i
    "KhÃ´ng tÃ¬m tháº¥y Ä‘Æ¡n hÃ ng";
endif

stop

@enduml


@startuml uc02-sequence-tracking
' ============================================
' UC02: THEO DÃ•I ÄÆ N HÃ€NG - Sequence Diagram
' ============================================

skinparam sequenceArrowThickness 2

title Sequence Diagram - UC02: Theo DÃµi ÄÆ¡n HÃ ng

actor "KhÃ¡ch hÃ ng" as KH #Gold
participant "TrackingUI" as UI #LightBlue
participant "TrackingController" as TC #LightGreen
participant "TrackingService" as TS #Pink
participant "WebSocket" as WS #Orange
database "Database" as DB #LightGray

autonumber

KH -> UI: Nháº­p mÃ£ tracking

UI -> TC: GET /tracking/{trackingNumber}
activate TC
TC -> TS: getOrderStatus()
activate TS
TS -> DB: SELECT order + status_history
activate DB
DB --> TS: Order + History
deactivate DB
TS --> TC: TrackingDTO
deactivate TS
TC --> UI: Order info + timeline
deactivate TC
UI --> KH: Hiá»ƒn thá»‹ thÃ´ng tin + timeline

alt Tráº¡ng thÃ¡i = OUT_FOR_DELIVERY
    KH -> UI: Nháº¥n "Xem vá»‹ trÃ­ shipper"
    
    UI -> WS: Connect /ws/tracking/{orderId}
    activate WS
    WS --> UI: Connected
    
    loop Má»—i 5 giÃ¢y
        WS --> UI: Push location {lat, lng}
        UI --> KH: Cáº­p nháº­t marker trÃªn báº£n Ä‘á»“
    end
    deactivate WS
end

@enduml


@startuml order-state-diagram
' ============================================
' STATE DIAGRAM - TRáº NG THÃI ÄÆ N HÃ€NG
' ============================================

skinparam state {
    BackgroundColor #FEFECE
    BorderColor #A80036
    StartColor green
    EndColor red
}

title State Diagram - Tráº¡ng ThÃ¡i ÄÆ¡n HÃ ng

[*] --> CREATED : Táº¡o Ä‘Æ¡n má»›i

CREATED --> PENDING_PICKUP : ÄÆ¡n online
CREATED --> AT_ORIGIN_OFFICE : ÄÆ¡n táº¡i quáº§y

PENDING_PICKUP --> PICKED_UP : Shipper láº¥y hÃ ng
PICKED_UP --> AT_ORIGIN_OFFICE : Mang vá» bÆ°u cá»¥c

AT_ORIGIN_OFFICE --> SORTED_AT_ORIGIN : PhÃ¢n loáº¡i xong
SORTED_AT_ORIGIN --> IN_TRANSIT_TO_HUB : Gom lÃ´ & xuáº¥t kho

IN_TRANSIT_TO_HUB --> AT_HUB : Äáº¿n hub
AT_HUB --> IN_TRANSIT_TO_DESTINATION : Chuyá»ƒn tiáº¿p
IN_TRANSIT_TO_DESTINATION --> AT_DESTINATION_HUB : Äáº¿n hub Ä‘Ã­ch

AT_DESTINATION_HUB --> IN_TRANSIT_TO_OFFICE : Váº­n chuyá»ƒn vá» bÆ°u cá»¥c
IN_TRANSIT_TO_OFFICE --> AT_DESTINATION_OFFICE : Äáº¿n bÆ°u cá»¥c Ä‘Ã­ch

AT_DESTINATION_OFFICE --> OUT_FOR_DELIVERY : Giao cho shipper

OUT_FOR_DELIVERY --> DELIVERED : Giao thÃ nh cÃ´ng âœ“
OUT_FOR_DELIVERY --> DELIVERY_FAILED : Giao tháº¥t báº¡i âœ—

DELIVERY_FAILED --> OUT_FOR_DELIVERY : Giao láº¡i
DELIVERY_FAILED --> RETURNING : Tráº£ hÃ ng

RETURNING --> RETURNED : ÄÃ£ tráº£ vá»

DELIVERED --> [*]
RETURNED --> [*]

@enduml


@startuml uc03-activity-batch
' ============================================
' UC03: QUáº¢N LÃ LÃ” HÃ€NG - Activity Diagram
' ============================================

skinparam activity {
    BackgroundColor #FEFECE
    BorderColor #A80036
    StartColor green
    EndColor red
}

title Activity Diagram - UC03: Quáº£n LÃ½ LÃ´ HÃ ng

start

:Xem danh sÃ¡ch lÃ´ hÃ ng;

if (Táº¡o má»›i hay xá»­ lÃ½ lÃ´ Ä‘ang Ä‘áº¿n?) then (Táº¡o má»›i)
    if (Thá»§ cÃ´ng hay tá»± Ä‘á»™ng?) then (Thá»§ cÃ´ng)
        :Chá»n Ä‘Ã­ch Ä‘áº¿n;
        
        repeat
            :Chá»n Ä‘Æ¡n hÃ ng;
            :ThÃªm Ä‘Æ¡n vÃ o lÃ´;
        repeat while (ThÃªm ná»¯a?) is (CÃ³)
        ->KhÃ´ng;
    else (Tá»± Ä‘á»™ng)
        :Há»‡ thá»‘ng tá»± Ä‘á»™ng phÃ¢n bá»•
        theo thuáº­t toÃ¡n FFD;
    endif
    
    :NiÃªm phong lÃ´ (SEAL);
    
    :Xuáº¥t kho (DISPATCH);
    
else (Xá»­ lÃ½ Ä‘áº¿n)
    :Xem lÃ´ hÃ ng Ä‘ang Ä‘áº¿n
    Status: IN_TRANSIT;
    
    :Chá»n lÃ´ cáº§n xÃ¡c nháº­n;
    
    :XÃ¡c nháº­n nháº­n hÃ ng (ARRIVED);
    
    :PhÃ¢n phá»‘i Ä‘Æ¡n hÃ ng (DISTRIBUTE);
    
    :Cáº­p nháº­t tráº¡ng thÃ¡i tá»«ng Ä‘Æ¡n;
endif

stop

@enduml


@startuml uc03-sequence-batch
' ============================================
' UC03: QUáº¢N LÃ LÃ” HÃ€NG - Sequence Diagram
' ============================================

skinparam sequenceArrowThickness 2

title Sequence Diagram - UC03: Quáº£n LÃ½ LÃ´ HÃ ng

actor "NhÃ¢n viÃªn Kho" as NV #Gold
participant "BatchUI" as UI #LightBlue
participant "BatchController" as BC #LightGreen
participant "BatchService" as BS #Pink
participant "OrderService" as OS #Orange
database "Database" as DB #LightGray

autonumber

== Táº¡o LÃ´ Má»›i ==

NV -> UI: Táº¡o lÃ´ má»›i
UI -> BC: POST /batches
activate BC
BC -> BS: createBatch(destination)
activate BS
BS -> DB: INSERT INTO batches
activate DB
DB --> BS: Batch created
deactivate DB
BS --> BC: BatchDTO
deactivate BS
BC --> UI: Batch info
deactivate BC
UI --> NV: Hiá»ƒn thá»‹ lÃ´ má»›i

== ThÃªm ÄÆ¡n VÃ o LÃ´ ==

NV -> UI: ThÃªm Ä‘Æ¡n vÃ o lÃ´
UI -> BC: POST /batches/{id}/add-orders
activate BC
BC -> BS: addOrders(batchId, orderIds)
activate BS
BS -> OS: validateOrders()
activate OS
OS -> DB: SELECT orders
activate DB
DB --> OS: Orders data
deactivate DB
OS --> BS: Valid orders
deactivate OS
BS -> DB: UPDATE orders SET batch_id
activate DB
DB --> BS: Updated
deactivate DB
BS --> BC: Success
deactivate BS
BC --> UI: Orders added
deactivate BC
UI --> NV: Cáº­p nháº­t danh sÃ¡ch

== NiÃªm Phong ==

NV -> UI: NiÃªm phong lÃ´
UI -> BC: POST /batches/{id}/seal
activate BC
BC -> BS: sealBatch()
activate BS
BS -> DB: UPDATE status='SEALED'
activate DB
DB --> BS: Updated
deactivate DB
BS --> BC: Sealed
deactivate BS
BC --> UI: Status: SEALED
deactivate BC
UI --> NV: LÃ´ Ä‘Ã£ niÃªm phong

== Xuáº¥t Kho ==

NV -> UI: Xuáº¥t kho
UI -> BC: POST /batches/{id}/dispatch
activate BC
BC -> BS: dispatch()
activate BS
BS -> DB: UPDATE status='IN_TRANSIT'
BS -> DB: UPDATE orders status
activate DB
DB --> BS: Updated
deactivate DB
BS --> BC: Dispatched
deactivate BS
BC --> UI: Status: IN_TRANSIT
deactivate BC
UI --> NV: ÄÃ£ xuáº¥t kho

@enduml


@startuml batch-state-diagram
' ============================================
' STATE DIAGRAM - TRáº NG THÃI LÃ” HÃ€NG
' ============================================

skinparam state {
    BackgroundColor #FEFECE
    BorderColor #A80036
}

title State Diagram - Tráº¡ng ThÃ¡i LÃ´ HÃ ng

[*] --> OPEN : Táº¡o lÃ´ má»›i

OPEN --> PROCESSING : Báº¯t Ä‘áº§u thÃªm Ä‘Æ¡n
OPEN --> CANCELLED : Há»§y lÃ´

PROCESSING --> SEALED : NiÃªm phong
PROCESSING --> CANCELLED : Há»§y lÃ´

SEALED --> IN_TRANSIT : Xuáº¥t kho
SEALED --> CANCELLED : Há»§y lÃ´

IN_TRANSIT --> ARRIVED : Äáº¿n nÆ¡i

ARRIVED --> DISTRIBUTED : PhÃ¢n phá»‘i Ä‘Æ¡n

DISTRIBUTED --> [*]
CANCELLED --> [*]

@enduml


@startuml uc04-activity-pickup
' ============================================
' UC04: Láº¤Y HÃ€NG (First-Mile) - Activity Diagram
' ============================================

skinparam activity {
    BackgroundColor #FEFECE
    BorderColor #A80036
    StartColor green
    EndColor red
}

title Activity Diagram - UC04: Láº¥y HÃ ng (First-Mile)

start

:Quáº£n lÃ½: Xem Ä‘Æ¡n PENDING_PICKUP;

:Chá»n Ä‘Æ¡n vÃ  phÃ¢n cÃ´ng cho Shipper;

:Shipper: Nháº­n thÃ´ng bÃ¡o;

:Shipper: Xem chi tiáº¿t Ä‘á»‹a chá»‰ láº¥y hÃ ng;

:Shipper: Báº¯t Ä‘áº§u ca (KÃ­ch hoáº¡t GPS);

:Di chuyá»ƒn Ä‘áº¿n Ä‘á»‹a chá»‰ khÃ¡ch hÃ ng;

:Láº¥y hÃ ng tá»« khÃ¡ch;

:XÃ¡c nháº­n PICKED_UP;

:Mang hÃ ng vá» bÆ°u cá»¥c;

:XÃ¡c nháº­n AT_ORIGIN_OFFICE;

stop

@enduml


@startuml uc04-activity-delivery
' ============================================
' UC04: GIAO HÃ€NG (Last-Mile) - Activity Diagram
' ============================================

skinparam activity {
    BackgroundColor #FEFECE
    BorderColor #A80036
    StartColor green
    EndColor red
}

title Activity Diagram - UC04: Giao HÃ ng (Last-Mile)

start

:Quáº£n lÃ½: Xem Ä‘Æ¡n AT_DESTINATION_OFFICE;

:Chá»n Ä‘Æ¡n vÃ  phÃ¢n cÃ´ng cho Shipper;

:Shipper: Nháº­n thÃ´ng bÃ¡o vÃ  xem danh sÃ¡ch;

:Shipper: Báº¯t Ä‘áº§u giao (KÃ­ch hoáº¡t GPS);

:Status â†’ OUT_FOR_DELIVERY;

:Di chuyá»ƒn Ä‘áº¿n ngÆ°á»i nháº­n
theo Google Maps;

if (CÃ³ thu COD?) then (CÃ³)
    :Thu tiá»n COD;
endif

if (Giao thÃ nh cÃ´ng?) then (CÃ³)
    :XÃ¡c nháº­n DELIVERED âœ“;
else (KhÃ´ng)
    :Chá»n lÃ½ do tháº¥t báº¡i;
    
    :Status â†’ DELIVERY_FAILED;
    
    if (Giao láº¡i hay tráº£ hÃ ng?) then (Giao láº¡i)
        :LÃªn lá»‹ch giao láº¡i;
    else (Tráº£ hÃ ng)
        :Status â†’ RETURNING;
    endif
endif

:Káº¿t thÃºc ca (Táº¯t GPS);

stop

@enduml


@startuml uc04-sequence-delivery
' ============================================
' UC04: GIAO HÃ€NG - Sequence Diagram
' ============================================

skinparam sequenceArrowThickness 2

title Sequence Diagram - UC04: Giao HÃ ng

actor "Quáº£n lÃ½ PhÆ°á»ng" as QL #LightBlue
actor "Shipper" as SH #Lime
actor "KhÃ¡ch hÃ ng" as KH #Gold
participant "ShipperUI" as UI #LightGray
participant "OrderController" as OC #LightGreen
participant "TrackingController" as TC #Pink
participant "WebSocket" as WS #Orange
database "Database" as DB #LightGray

autonumber

== PhÃ¢n CÃ´ng ==

QL -> UI: PhÃ¢n cÃ´ng Ä‘Æ¡n cho Shipper
UI -> OC: POST /orders/{id}/assign-delivery
activate OC
OC -> DB: UPDATE order SET shipper_id
activate DB
DB --> OC: Updated
deactivate DB
OC --> UI: Assigned
deactivate OC

== Shipper Nháº­n ÄÆ¡n ==

SH -> UI: Xem Ä‘Æ¡n Ä‘Æ°á»£c giao
UI -> OC: GET /shipper/orders
activate OC
OC -> DB: SELECT orders WHERE shipper_id
activate DB
DB --> OC: Orders list
deactivate DB
OC --> UI: Orders
deactivate OC
UI --> SH: Danh sÃ¡ch Ä‘Æ¡n

== Báº¯t Äáº§u Giao ==

SH -> UI: Báº¯t Ä‘áº§u giao hÃ ng
UI -> TC: POST /tracking/start-session
activate TC
TC -> DB: UPDATE status = OUT_FOR_DELIVERY
activate DB
DB --> TC: Updated
deactivate DB
TC --> UI: Session started
deactivate TC
UI --> SH: GPS Ä‘Ã£ báº­t

== Theo DÃµi GPS ==

loop Má»—i 5 giÃ¢y
    SH -> UI: GPS location
    UI -> TC: POST /tracking/update-location
    TC -> WS: Broadcast location
    WS --> KH: Push location {lat, lng}
end

== XÃ¡c Nháº­n Giao ==

SH -> UI: XÃ¡c nháº­n DELIVERED
UI -> OC: POST /orders/{id}/delivered
activate OC
OC -> DB: UPDATE status = DELIVERED
activate DB
DB --> OC: Updated
deactivate DB
OC --> UI: Delivered
deactivate OC
UI --> SH: Giao hÃ ng thÃ nh cÃ´ng âœ“

@enduml


@startuml uc05-activity-management
' ============================================
' UC05: QUáº¢N LÃ BÆ¯U Cá»¤C & NHÃ‚N VIÃŠN - Activity Diagram
' ============================================

skinparam activity {
    BackgroundColor #FEFECE
    BorderColor #A80036
    StartColor green
    EndColor red
}

title Activity Diagram - UC05: Quáº£n LÃ½ BÆ°u Cá»¥c & NhÃ¢n ViÃªn

start

:ÄÄƒng nháº­p vá»›i vai trÃ² quáº£n lÃ½;

switch (Quáº£n lÃ½ gÃ¬?)
case (BÆ°u cá»¥c)
    :Xem DS bÆ°u cá»¥c theo pháº¡m vi;
    
    switch (Thao tÃ¡c?)
    case (ThÃªm)
        :Nháº­p thÃ´ng tin bÆ°u cá»¥c má»›i;
        :Chá»n vá»‹ trÃ­ Ä‘á»‹a lÃ½ (Tá»‰nh/Huyá»‡n/XÃ£);
    case (Sá»­a)
        :Cáº­p nháº­t thÃ´ng tin;
    case (XÃ³a)
        :Soft delete;
    endswitch

case (NhÃ¢n viÃªn)
    :Xem DS nhÃ¢n viÃªn theo pháº¡m vi;
    
    switch (Thao tÃ¡c?)
    case (ThÃªm)
        :Nháº­p thÃ´ng tin NV + vai trÃ²;
        :Táº¡o tÃ i khoáº£n Ä‘Äƒng nháº­p;
    case (Sá»­a)
        :Cáº­p nháº­t thÃ´ng tin;
    case (XÃ³a)
        :VÃ´ hiá»‡u hÃ³a tÃ i khoáº£n;
    endswitch
endswitch

:LÆ°u vÃ o DB;

:Hiá»ƒn thá»‹ káº¿t quáº£;

stop

@enduml


@startuml uc05-sequence-create-employee
' ============================================
' UC05: Táº O NHÃ‚N VIÃŠN - Sequence Diagram
' ============================================

skinparam sequenceArrowThickness 2

title Sequence Diagram - UC05: Táº¡o NhÃ¢n ViÃªn

actor "Admin" as AD #LightBlue
participant "EmployeeUI" as UI #LightGray
participant "UserController" as UC #LightGreen
participant "UserService" as US #Pink
participant "AuthService" as AS #Orange
database "Database" as DB #LightGray

autonumber

AD -> UI: Má»Ÿ form thÃªm nhÃ¢n viÃªn

UI -> UC: GET /offices (in scope)
activate UC
UC -> US: getOffices()
activate US
US -> DB: SELECT offices
activate DB
DB --> US: Offices list
deactivate DB
US --> UC: OfficeDTO[]
deactivate US
UC --> UI: Available offices
deactivate UC
UI --> AD: Hiá»ƒn thá»‹ form

AD -> UI: Nháº­p thÃ´ng tin nhÃ¢n viÃªn

UI -> UC: POST /users/employees
activate UC
UC -> US: createEmployee()
activate US

US -> DB: Validate role permissions
activate DB
DB --> US: Valid
deactivate DB

US -> AS: createAccount()
activate AS
AS -> AS: hashPassword()
AS -> DB: INSERT INTO accounts
activate DB
DB --> AS: Account created
deactivate DB
AS --> US: AccountDTO
deactivate AS

US -> DB: INSERT INTO employees
activate DB
DB --> US: Employee created
deactivate DB
US --> UC: EmployeeDTO
deactivate US
UC --> UI: Success + login info
deactivate UC
UI --> AD: ThÃ´ng bÃ¡o táº¡o thÃ nh cÃ´ng\n+ thÃ´ng tin Ä‘Äƒng nháº­p

@enduml


@startuml organization-structure
' ============================================
' Cáº¤U TRÃšC Tá»” CHá»¨C
' ============================================

skinparam packageStyle rectangle

title Cáº¥u TrÃºc Tá»• Chá»©c - Há»‡ Thá»‘ng BÆ°u ChÃ­nh

package "TRá»¤ Sá» CHÃNH" #LightBlue {
    actor "SYSTEM_ADMIN" as SA
}

package "HUB MIá»€N Báº®C" #LightGreen {
    actor "HUB_ADMIN" as HA1
}

package "HUB MIá»€N TRUNG" #LightGreen {
    actor "HUB_ADMIN" as HA2
}

package "HUB MIá»€N NAM" #LightGreen {
    actor "HUB_ADMIN" as HA3
}

package "Tá»ˆNH" #LightYellow {
    component "PROVINCE_WAREHOUSE\n(Kho tá»‰nh)" as PW
    component "PROVINCE_POST\n(BÆ°u cá»¥c tá»‰nh)" as PP
}

package "PHÆ¯á»œNG/XÃƒ" #Orange {
    component "WARD_WAREHOUSE\n(Kho phÆ°á»ng)" as WW
    component "WARD_POST\n(BÆ°u cá»¥c phÆ°á»ng)" as WP
    actor "STAFF" as ST
    actor "SHIPPER" as SH
}

SA --> HA1
SA --> HA2
SA --> HA3

HA1 --> PW
HA1 --> PP

PW --> WW
PP --> WP

WW --> ST
WP --> ST
WW --> SH
WP --> SH

@enduml


@startuml erd-diagram
' ============================================
' ENTITY RELATIONSHIP DIAGRAM
' ============================================

skinparam linetype ortho

title Entity Relationship Diagram - Postal Management System

entity "CUSTOMER" as customer {
    * id : Long <<PK>>
    --
    * name : String
    * phone : String
    email : String
    subscription : SubscriptionType
}

entity "ORDER" as order {
    * id : Long <<PK>>
    --
    * trackingNumber : String <<UK>>
    * senderName : String
    * senderPhone : String
    * receiverName : String
    * receiverPhone : String
    * receiverAddress : String
    * status : OrderStatus
    serviceType : ServiceType
    price : BigDecimal
    codAmount : BigDecimal
    customer_id : Long <<FK>>
    batch_id : Long <<FK>>
    office_id : Long <<FK>>
}

entity "EMPLOYEE" as employee {
    * id : Long <<PK>>
    --
    * name : String
    * phone : String
    * role : Role
    office_id : Long <<FK>>
    account_id : Long <<FK>>
}

entity "OFFICE" as office {
    * id : Long <<PK>>
    --
    * name : String
    * type : OfficeType
    * address : String
    ward_id : Long <<FK>>
}

entity "BATCH_PACKAGE" as batch {
    * id : Long <<PK>>
    --
    * status : BatchStatus
    origin_office_id : Long <<FK>>
    destination_office_id : Long <<FK>>
}

entity "ORDER_STATUS_HISTORY" as history {
    * id : Long <<PK>>
    --
    * status : OrderStatus
    * timestamp : DateTime
    order_id : Long <<FK>>
}

entity "PROVINCE" as province {
    * code : String <<PK>>
    --
    * name : String
}

entity "DISTRICT" as district {
    * code : String <<PK>>
    --
    * name : String
    province_code : String <<FK>>
}

entity "WARD" as ward {
    * code : String <<PK>>
    --
    * name : String
    district_code : String <<FK>>
}

customer ||--o{ order : creates
employee ||--o{ order : handles
office ||--o{ employee : employs
office ||--o{ order : processes
order ||--o{ history : has
order }o--|| batch : belongs_to
batch ||--|| office : origin
batch ||--|| office : destination
province ||--o{ district : contains
district ||--o{ ward : contains
ward ||--o{ office : located_in

@enduml


@startuml component-diagram
' ============================================
' COMPONENT DIAGRAM
' ============================================

skinparam componentStyle uml2

title Component Diagram - Kiáº¿n TrÃºc Há»‡ Thá»‘ng

package "Frontend - React + TypeScript" #LightBlue {
    component [UI Components] as UI
    component [Pages] as Pages
    component [API Services] as FServices
    component [Auth Context] as Context
}

package "Backend - Spring Boot" #LightGreen {
    component [Controllers] as Controllers
    component [Services] as BServices
    component [Repositories] as Repos
    component [Spring Security] as Security
}

package "Database - MySQL" #LightYellow {
    database [Tables] as Tables
}

package "External Services" #Pink {
    component [Google Maps API] as Maps
    component [WebSocket Server] as WS
}

UI --> Pages
Pages --> FServices
Pages --> Context
FServices --> Controllers
Context --> Security

Controllers --> BServices
BServices --> Repos
Repos --> Tables

FServices --> Maps
FServices --> WS

@enduml


@startuml deployment-diagram
' ============================================
' DEPLOYMENT DIAGRAM
' ============================================

skinparam nodeStyle rectangle

title Deployment Diagram - Triá»ƒn Khai Docker

node "Client" #LightBlue {
    component [Web Browser] as Browser
}

node "Server" #LightGreen {
    node "Docker Compose" #LightYellow {
        node "Frontend Container" #Pink {
            component [Nginx + React] as FE
        }
        
        node "Backend Container" #Cyan {
            component [Spring Boot] as BE
        }
        
        node "Database Container" #Orange {
            database [MySQL 8.0] as DB
        }
    }
}

Browser --> FE : HTTPS
FE --> BE : REST API
BE --> DB : JDBC

@enduml


@startuml sitemap-diagram
' ============================================
' SITEMAP DIAGRAM - Cáº¤U TRÃšC TRANG WEB
' ============================================

skinparam defaultTextAlignment center
skinparam rectangle {
    BackgroundColor #FEFECE
    BorderColor #A80036
    RoundCorner 10
}

title Sitemap - Há»‡ Thá»‘ng Quáº£n LÃ½ BÆ°u ChÃ­nh

rectangle "ğŸ  **Trang Chá»§**\n/" as Home #LightBlue

rectangle "ğŸ” **XÃ¡c Thá»±c**" as Auth #LightGray {
    rectangle "ÄÄƒng nháº­p\n/login" as Login
    rectangle "ÄÄƒng kÃ½\n/register" as Register
    rectangle "QuÃªn máº­t kháº©u\n/forgot-password" as Forgot
}

rectangle "ğŸ“¦ **Theo DÃµi ÄÆ¡n HÃ ng** (Public)\n/tracking" as Tracking #LightGreen

rectangle "ğŸ‘¤ **KhÃ¡ch HÃ ng**" as Customer #Gold {
    rectangle "Dashboard\n/customer" as CustDash
    rectangle "Táº¡o Ä‘Æ¡n láº¥y hÃ ng\n/customer/pickup" as CustPickup
    rectangle "ÄÆ¡n hÃ ng cá»§a tÃ´i\n/customer/orders" as CustOrders
    rectangle "Há»“ sÆ¡\n/customer/profile" as CustProfile
}

rectangle "ğŸ–¥ï¸ **NhÃ¢n ViÃªn Quáº§y**" as Counter #Cyan {
    rectangle "Dashboard\n/counter" as CounterDash
    rectangle "Táº¡o Ä‘Æ¡n má»›i\n/counter/create-order" as CreateOrder
    rectangle "Danh sÃ¡ch Ä‘Æ¡n\n/counter/orders" as CounterOrders
    rectangle "TÃ­nh giÃ¡\n/counter/pricing" as Pricing
}

rectangle "ğŸ“¦ **NhÃ¢n ViÃªn Kho**" as Warehouse #Pink {
    rectangle "Dashboard\n/warehouse" as WHDash
    rectangle "Quáº£n lÃ½ lÃ´ hÃ ng\n/warehouse/batches" as Batches
    rectangle "Táº¡o lÃ´ má»›i\n/warehouse/batches/new" as NewBatch
    rectangle "LÃ´ hÃ ng Ä‘áº¿n\n/warehouse/incoming" as Incoming
    rectangle "PhÃ¢n loáº¡i\n/warehouse/sorting" as Sorting
}

rectangle "ğŸšš **Shipper**" as Shipper #Lime {
    rectangle "Dashboard\n/shipper" as ShipperDash
    rectangle "ÄÆ¡n láº¥y hÃ ng\n/shipper/pickups" as Pickups
    rectangle "ÄÆ¡n giao hÃ ng\n/shipper/deliveries" as Deliveries
    rectangle "Báº£n Ä‘á»“\n/shipper/map" as ShipperMap
    rectangle "Lá»‹ch sá»­\n/shipper/history" as ShipperHistory
}

rectangle "ğŸ“ **Quáº£n LÃ½ PhÆ°á»ng**" as WardMgr #Orange {
    rectangle "Dashboard\n/ward-manager" as WMDash
    rectangle "Quáº£n lÃ½ nhÃ¢n viÃªn\n/ward-manager/staff" as WMStaff
    rectangle "Quáº£n lÃ½ shipper\n/ward-manager/shippers" as WMShippers
    rectangle "PhÃ¢n cÃ´ng giao hÃ ng\n/ward-manager/assign" as WMAssign
    rectangle "BÃ¡o cÃ¡o\n/ward-manager/reports" as WMReports
}

rectangle "ğŸ›ï¸ **Quáº£n Trá»‹ Tá»‰nh**" as ProvAdmin #LightYellow {
    rectangle "Dashboard\n/province-admin" as PADash
    rectangle "Quáº£n lÃ½ bÆ°u cá»¥c\n/province-admin/offices" as PAOffices
    rectangle "Quáº£n lÃ½ nhÃ¢n viÃªn\n/province-admin/employees" as PAEmployees
    rectangle "Tuyáº¿n váº­n chuyá»ƒn\n/province-admin/routes" as PARoutes
    rectangle "BÃ¡o cÃ¡o\n/province-admin/reports" as PAReports
}

rectangle "ğŸ¢ **Quáº£n Trá»‹ Hub**" as HubAdmin #LightGreen {
    rectangle "Dashboard\n/hub-admin" as HADash
    rectangle "BÆ°u cá»¥c tá»‰nh\n/hub-admin/provinces" as HAProvinces
    rectangle "Quáº£n lÃ½ nhÃ¢n viÃªn\n/hub-admin/employees" as HAEmployees
    rectangle "Báº£n Ä‘á»“ máº¡ng lÆ°á»›i\n/hub-admin/network" as HANetwork
    rectangle "Thá»‘ng kÃª\n/hub-admin/statistics" as HAStats
}

rectangle "ğŸ”§ **Quáº£n Trá»‹ Há»‡ Thá»‘ng**" as SysAdmin #LightBlue {
    rectangle "Dashboard\n/system-admin" as SADash
    rectangle "Quáº£n lÃ½ Hub\n/system-admin/hubs" as SAHubs
    rectangle "Quáº£n lÃ½ tÃ i khoáº£n\n/system-admin/accounts" as SAAccounts
    rectangle "Cáº¥u hÃ¬nh há»‡ thá»‘ng\n/system-admin/settings" as SASettings
    rectangle "Nháº­t kÃ½ há»‡ thá»‘ng\n/system-admin/logs" as SALogs
}

' Connections
Home --> Auth
Home --> Tracking
Home --> Customer
Home --> Counter
Home --> Warehouse
Home --> Shipper
Home --> WardMgr
Home --> ProvAdmin
Home --> HubAdmin
Home --> SysAdmin

@enduml


@startuml sitemap-detailed
' ============================================
' SITEMAP CHI TIáº¾T - MINDMAP STYLE
' ============================================

<style>
mindmapDiagram {
    node {
        BackgroundColor #FEFECE
        BorderColor #A80036
        FontColor black
    }
    :depth(0) {
        BackgroundColor #ADD8E6
    }
    :depth(1) {
        BackgroundColor #90EE90
    }
    :depth(2) {
        BackgroundColor #FFFACD
    }
    :depth(3) {
        BackgroundColor #FFE4E1
    }
}
</style>

* ğŸ  Postal Management System
** ğŸ” Auth
*** /login - ÄÄƒng nháº­p
*** /register - ÄÄƒng kÃ½
*** /forgot-password - QuÃªn máº­t kháº©u
** ğŸ“¦ /tracking - Theo dÃµi Ä‘Æ¡n (Public)
*** Chi tiáº¿t Ä‘Æ¡n hÃ ng
*** Vá»‹ trÃ­ GPS shipper
** ğŸ‘¤ Customer Portal
*** /customer - Dashboard
*** /customer/pickup - Táº¡o Ä‘Æ¡n láº¥y hÃ ng
*** /customer/orders - ÄÆ¡n hÃ ng cá»§a tÃ´i
**** Chi tiáº¿t Ä‘Æ¡n
**** Theo dÃµi Ä‘Æ¡n
*** /customer/profile - Há»“ sÆ¡ cÃ¡ nhÃ¢n
** ğŸ–¥ï¸ Counter Staff
*** /counter - Dashboard
*** /counter/create-order - Táº¡o Ä‘Æ¡n má»›i
**** Nháº­p thÃ´ng tin
**** TÃ­nh giÃ¡
**** XÃ¡c nháº­n & In phiáº¿u
*** /counter/orders - Danh sÃ¡ch Ä‘Æ¡n
** ğŸ“¦ Warehouse Staff
*** /warehouse - Dashboard
*** /warehouse/batches - Quáº£n lÃ½ lÃ´
**** Danh sÃ¡ch lÃ´
**** Táº¡o lÃ´ má»›i
**** Chi tiáº¿t lÃ´
*** /warehouse/incoming - LÃ´ Ä‘ang Ä‘áº¿n
*** /warehouse/sorting - PhÃ¢n loáº¡i
** ğŸšš Shipper
*** /shipper - Dashboard
*** /shipper/pickups - ÄÆ¡n láº¥y hÃ ng
*** /shipper/deliveries - ÄÆ¡n giao hÃ ng
**** Chi tiáº¿t giao hÃ ng
**** Cáº­p nháº­t tráº¡ng thÃ¡i
*** /shipper/map - Báº£n Ä‘á»“ Ä‘iá»u hÆ°á»›ng
*** /shipper/history - Lá»‹ch sá»­
** ğŸ“ Ward Manager
*** /ward-manager - Dashboard
*** /ward-manager/staff - Quáº£n lÃ½ NV
**** Danh sÃ¡ch
**** ThÃªm/Sá»­a/XÃ³a
*** /ward-manager/shippers - Quáº£n lÃ½ Shipper
*** /ward-manager/assign - PhÃ¢n cÃ´ng
*** /ward-manager/reports - BÃ¡o cÃ¡o
** ğŸ›ï¸ Province Admin
*** /province-admin - Dashboard
*** /province-admin/offices - BÆ°u cá»¥c
**** Danh sÃ¡ch
**** ThÃªm/Sá»­a/XÃ³a
*** /province-admin/employees - NhÃ¢n viÃªn
*** /province-admin/routes - Tuyáº¿n Ä‘Æ°á»ng
*** /province-admin/reports - BÃ¡o cÃ¡o
** ğŸ¢ Hub Admin
*** /hub-admin - Dashboard
*** /hub-admin/provinces - BÆ°u cá»¥c tá»‰nh
*** /hub-admin/employees - NhÃ¢n viÃªn
*** /hub-admin/network - Máº¡ng lÆ°á»›i
*** /hub-admin/statistics - Thá»‘ng kÃª
** ğŸ”§ System Admin
*** /system-admin - Dashboard
*** /system-admin/hubs - Quáº£n lÃ½ Hub
*** /system-admin/accounts - TÃ i khoáº£n
*** /system-admin/settings - Cáº¥u hÃ¬nh
*** /system-admin/logs - Nháº­t kÃ½

@endmindmap

@enduml


@startuml sitemap-navigation-flow
' ============================================
' SITEMAP - LUá»’NG ÄIá»€U HÆ¯á»šNG THEO VAI TRÃ’
' ============================================

skinparam state {
    BackgroundColor #FEFECE
    BorderColor #A80036
}

title Luá»“ng Äiá»u HÆ°á»›ng Theo Vai TrÃ²

state "ğŸ  Trang Chá»§" as Home #LightBlue
state "ğŸ” ÄÄƒng Nháº­p" as Login #LightGray

state "XÃ¡c Thá»±c Vai TrÃ²" as AuthCheck <<choice>>

state "ğŸ‘¤ Customer Portal" as CustomerPortal #Gold {
    state "Dashboard" as CD
    state "Táº¡o Ä‘Æ¡n pickup" as CP
    state "ÄÆ¡n hÃ ng cá»§a tÃ´i" as CO
    state "Há»“ sÆ¡" as CPr
    
    CD --> CP
    CD --> CO
    CD --> CPr
}

state "ğŸ–¥ï¸ Counter Staff Portal" as CounterPortal #Cyan {
    state "Dashboard" as CSD
    state "Táº¡o Ä‘Æ¡n má»›i" as CSC
    state "Danh sÃ¡ch Ä‘Æ¡n" as CSO
    
    CSD --> CSC
    CSD --> CSO
}

state "ğŸ“¦ Warehouse Portal" as WarehousePortal #Pink {
    state "Dashboard" as WHD
    state "Quáº£n lÃ½ lÃ´" as WHB
    state "LÃ´ Ä‘ang Ä‘áº¿n" as WHI
    state "PhÃ¢n loáº¡i" as WHS
    
    WHD --> WHB
    WHD --> WHI
    WHD --> WHS
}

state "ğŸšš Shipper Portal" as ShipperPortal #Lime {
    state "Dashboard" as SHD
    state "ÄÆ¡n láº¥y hÃ ng" as SHP
    state "ÄÆ¡n giao hÃ ng" as SHDe
    state "Báº£n Ä‘á»“" as SHM
    
    SHD --> SHP
    SHD --> SHDe
    SHD --> SHM
}

state "ğŸ“ Ward Manager Portal" as WardPortal #Orange {
    state "Dashboard" as WMD
    state "Quáº£n lÃ½ NV" as WMS
    state "PhÃ¢n cÃ´ng" as WMA
    state "BÃ¡o cÃ¡o" as WMR
    
    WMD --> WMS
    WMD --> WMA
    WMD --> WMR
}

state "ğŸ›ï¸ Province Admin Portal" as ProvincePortal #LightYellow {
    state "Dashboard" as PAD
    state "BÆ°u cá»¥c" as PAO
    state "NhÃ¢n viÃªn" as PAE
    state "Tuyáº¿n Ä‘Æ°á»ng" as PAR
    
    PAD --> PAO
    PAD --> PAE
    PAD --> PAR
}

state "ğŸ¢ Hub Admin Portal" as HubPortal #LightGreen {
    state "Dashboard" as HAD
    state "BÆ°u cá»¥c tá»‰nh" as HAP
    state "Máº¡ng lÆ°á»›i" as HAN
    state "Thá»‘ng kÃª" as HAS
    
    HAD --> HAP
    HAD --> HAN
    HAD --> HAS
}

state "ğŸ”§ System Admin Portal" as SysPortal #LightBlue {
    state "Dashboard" as SAD
    state "Quáº£n lÃ½ Hub" as SAH
    state "TÃ i khoáº£n" as SAA
    state "Cáº¥u hÃ¬nh" as SAS
    
    SAD --> SAH
    SAD --> SAA
    SAD --> SAS
}

[*] --> Home
Home --> Login
Login --> AuthCheck

AuthCheck --> CustomerPortal : CUSTOMER
AuthCheck --> CounterPortal : COUNTER_STAFF
AuthCheck --> WarehousePortal : WAREHOUSE_STAFF
AuthCheck --> ShipperPortal : SHIPPER
AuthCheck --> WardPortal : WARD_MANAGER
AuthCheck --> ProvincePortal : PROVINCE_ADMIN
AuthCheck --> HubPortal : HUB_ADMIN
AuthCheck --> SysPortal : SYSTEM_ADMIN

@enduml
